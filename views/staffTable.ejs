<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Spec: Staff Table</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- CSS -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
    <script src="../lib/bootstrap-datepicker.js"></script>
    <script>
      var fixParantheses = function(s) {
        return s.replace("&#35;","#").replace("&#41;",")").replace("&amp;#40;","(");
      }
      var user = '';
      $(document).ready(function() {
         _.templateSettings.variable = "rc";
        $('body').html(fixParantheses($('body').html()));
        $('body').html(fixParantheses($('body').html())); 
        //this is important because some HTML characters consist of other HTML characters, so double decoding is needed
        var today = new Date();
        today.setHours(0);
        today.setMinutes(0);
        today.setSeconds(0);
        today.setMilliseconds(0);
        var lastWeek = new Date(today.getTime() - 24 * 60 * 60 * 1000 * 7);
        $('.date').datepicker();
        $('#d1').datepicker('setValue', lastWeek);
        $('#d2').datepicker('setValue', today);
        $('#send').click(function(e) {
          $.ajax({
            type: "GET",
            url: "../staff/table",
            data: {
              'start': $('#d1').data('datepicker').date,
              'end': $('#d2').data('datepicker').date,
            }
          }).done(function(msg) {
            if(msg == 'false') {
              return false;
            }
            var template = _.template( $(".template").html(), {'staff': JSON.parse(msg)});
            //console.log(template);
            $('#content').html(template);
          });
        });
      });
      var formatAMPM = function(date) {
          var hours = date.getHours();
          var minutes = date.getMinutes();
          var ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12;
          hours = hours ? hours : 12; // the hour '0' should be '12'
          minutes = minutes < 10 ? '0'+minutes : minutes;
          var strTime = hours + ':' + minutes + ' ' + ampm;
          return strTime;
        }; //end formatAMPM
   </script>
    <link href="http://getbootstrap.com/2.3.2/assets/css/bootstrap.css" rel="stylesheet" media="screen,print">
    <link href="../lib/bootstrap-datepicker.css" rel="stylesheet">
    <style type="text/css">

      /* Sticky footer styles
      -------------------------------------------------- */

      html,
      body {
        height: 100%;
        /* The html and body elements cannot have any padding or margin. */
      }

      /* Wrapper for page content to push down footer */
      #wrap {
        min-height: 100%;
        height: auto !important;
        height: 100%;
        /* Negative indent footer by it's height */
        margin: 0 auto -60px;
      }

      /* Set the fixed height of the footer here */
      #push,
      #footer {
        height: 60px;
      }
      #footer {
        background-color: #f5f5f5;
      }

      /* Lastly, apply responsive CSS fixes as necessary */
      @media (max-width: 767px) {
        #footer {
          margin-left: -20px;
          margin-right: -20px;
          padding-left: 20px;
          padding-right: 20px;
        }
      }



      /* Custom page CSS
      -------------------------------------------------- */
      /* Not required for template or sticky footer method. */

      .container {
        width: auto;
        max-width: 680px;
      }
      .container .credit {
        margin: 20px 0;
      }
      .combobox-container {
        margin-bottom: 5px;
        *zoom: 1;
      }
      .combobox-container:before,
      .combobox-container:after {
        display: table;
        content: "";
      }
      .combobox-container:after {
        clear: both;
      }
      .combobox-container input,
      .combobox-container .uneditable-input {
        -webkit-border-radius: 0 3px 3px 0;
        -moz-border-radius: 0 3px 3px 0;
        border-radius: 0 3px 3px 0;
      }
      .combobox-container input:focus,
      .combobox-container .uneditable-input:focus {
        position: relative;
        z-index: 2;
      }
      .combobox-container .uneditable-input {
        border-left-color: #ccc;
      }
      .combobox-container .add-on {
        float: left;
        display: inline-block;
        width: auto;
        min-width: 16px;
        height: inherit !important;
        margin-right: -1px;
        padding: 4px 5px;
        font-weight: normal;
        color: #999999;
        text-align: center;
        text-shadow: 0 1px 0 #ffffff;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        -webkit-border-radius: 3px 0 0 3px;
        -moz-border-radius: 3px 0 0 3px;
        border-radius: 3px 0 0 3px;
        
      }
      .combobox-container .active {
        background-color: #a9dba9;
        border-color: #46a546;
      }
      .combobox-container input,
      .combobox-container .uneditable-input {
        float: left;
        -webkit-border-radius: 3px 0 0 3px;
        -moz-border-radius: 3px 0 0 3px;
        border-radius: 3px 0 0 3px;
      }
      .combobox-container .uneditable-input {
        border-left-color: #eee;
        border-right-color: #ccc;
      }
      .combobox-container .add-on {
        margin-right: 0;
        margin-left: -1px;
        -webkit-border-radius: 0 3px 3px 0;
        -moz-border-radius: 0 3px 3px 0;
        border-radius: 0 3px 3px 0;
      }
      .combobox-container input:first-child {
        *margin-left: -160px;
      }
      .combobox-container input:first-child + .add-on {
        *margin-left: -21px;
      }
      .combobox-container select {
        display: inline-block;
        width: 0;
        height: 0;
        border: 0;
        padding: 0;
        margin: 0;
        text-indent: -99999px;
        *text-indent: 0;
      }
      .form-search .combobox-container,
      .form-inline .combobox-container {
        display: inline-block;
        margin-bottom: 0;
        vertical-align: top;
      }
      .form-search .combobox-container .add-on,
      .form-inline .combobox-container .add-on {
        vertical-align: middle;
      }
      .combobox-selected .combobox-clear {
        display: inline-block;
      }
      .combobox-selected .caret {
        display: none;
      }
      .combobox-clear {
        display: none;
        width: 14px;
        height: 14px;
        line-height: 14px;
        vertical-align: top;
        opacity: 0.3;
        filter: alpha(opacity=30);
      }
      .dropdown:hover .combobox-clear,
      .open.dropdown .combobox-clear {
        opacity: 1;
        filter: alpha(opacity=100);
      }
      .btn .combobox-clear {
        margin-top: 1px;
        margin-left: 1px;
      }
      .btn:hover .combobox-clear,
      .open.btn-group .combobox-clear {
        opacity: 1;
        filter: alpha(opacity=100);
      }
      .typeahead-long {
        max-height: 300px;
        overflow-y: auto;
      }
      .control-group.error .combobox-container .add-on {
        color: #B94A48;
        border-color: #B94A48;
      }
      .control-group.error .combobox-container .caret {
        border-top-color: #B94A48;
      }
      .control-group.warning .combobox-container .add-on {
        color: #C09853;
        border-color: #C09853;
      }
      .control-group.warning .combobox-container .caret {
        border-top-color: #C09853;
      }
      .control-group.success .combobox-container .add-on {
        color: #468847;
        border-color: #468847;
      }
      .control-group.success .combobox-container .caret {
        border-top-color: #468847;
      }
      .btn .combobox-clear [class^="icon-"] {
        line-height: 1.4em;
      }
    </style>

  </head>

  <body>


    <!-- Part 1: Wrap all page content here -->
    <div id="wrap">
      <!-- Begin page content -->
         <!-- Begin page content -->
      <div class="container">
        <div class="page-header"><span class="pull-right"><a class="btn btn-info btn-large" href="../">Back to Spec</a></span>
          <h2>Spec: Staff Table</h2>

        </div>
        <p class="lead">Choose a timespan that you want to see all staff, with the total number of events and hours they worked.</p>
        <div class="form-inline">
        <div class="input-append date" id="d1" data-date="00-00-0000" data-date-format="mm-dd-yyyy">
          <input class="input-small" size="16" type="text">
          <span class="add-on"><i class="icon-th"></i></span>
        </div>
        <div class="input-append date" id="d2" data-date="00-00-0000" data-date-format="mm-dd-yyyy">
          <input class="input-small" size="16" type="text">
          <span class="add-on"><i class="icon-th"></i></span>
        </div>
        <button class="btn btn-primary" id="send" type="button">See the list</button>
        </div>
        <hr>
        <!-- this is where all the stuff is loaded after an ajax request-->
        <div id="content">
        </div>
        <p></p>
      </div>

      <div id="push"></div>
    </div>
    <div id="footer">
      <div class="container">
        <p class="muted credit">Wesleyan University Instructional Media Services - Special Events Calendar (Spec).</p>
      </div>
    </div>

  </body>
    <script type="text/template" class="template">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Staff</th>
            <th>Number of events</th>
            <th>Number of hours</th>
          </tr>
        </thead>
        <tbody>
         <% _.each(rc.staff, function(value, key) { %>
            <% if(key !== '') { %>
              <tr>
                <td>(<%= key %>)</td>
                <td><%= value.event %></td>
                <td><%= value.hour.toFixed(2) %></td>
              </tr>
            <% } %>
          <% }) %>
        </tbody>
      </table>
    </script>
</html>