/*! Spec 0.1.5 */
var Inventory=Backbone.Model.extend({urlRoot:"inventory/db",initialize:function(){this.on("change",function(a){console.log(a.changed),$.ajax({type:"PATCH",url:pageableInventoryList.url+"/"+a.get("_id"),data:a.changed}).done(function(){pageableInventoryList.fetch({reset:!0})})})}}),PageableInventoryList=Backbone.PageableCollection.extend({model:Inventory,url:"/inventory/db",state:{pageSize:20},mode:"client"}),pageableInventoryList=new PageableInventoryList;pageableInventoryList.comparator="name",pageableInventoryList.sort();var columns=[{name:"",cell:"select-row",headerCell:"select-all",renderable:!0},{name:"id",label:"Id",cell:"integer",editable:!1},{name:"text",label:"Name",cell:"string",direction:"ascending"},{name:"price",label:"Hourly Price ($)",cell:"integer"}],pageableGrid=new Backgrid.Grid({columns:columns,collection:pageableInventoryList});$stuff=$(".stuff"),$stuff.append(pageableGrid.render().el);var paginator=new Backgrid.Extension.Paginator({collection:pageableInventoryList});$stuff.after(paginator.render().el);var filter=new Backgrid.Extension.ClientSideFilter({collection:pageableInventoryList,fields:["text"]});$stuff.before(filter.render().el),$(filter.el).css({"float":"right",margin:"20px"}),pageableInventoryList.fetch({reset:!0}),$.fn.editable.defaults.mode="inline",$("#newInventory").click(function(){$("#newModal .modal-body").html(_.template($("#newTemplate").html())),$(".x-add").editable({}),$("#name").editable("option","validate",function(a){return a?void 0:"Required field!"}),$("#price").editable("option","validate",function(a){if(!a)return"Required field!";var b=/^[0-9]+$/;return b.test(a)?void 0:"Numbers only!"}),$(".x-add").on("save",function(){var a=this;setTimeout(function(){$(a).closest("tr").next().find(".x-add").editable("show")},200)}),$("#newModal").modal("show")}),$("#newModal .btn-primary").click(function(){var a=$("#name").editable("getValue",!0),b=parseInt($("#price").editable("getValue",!0));if(""===a||isNaN(b)){var c="Name has to be filled and the price has to be a valid number.";return void $("#msg").removeClass("alert-success").addClass("alert-error").html(c).show()}var d={text:a,price:b};console.log(d),$.ajax({type:"POST",url:pageableInventoryList.url,data:d}).done(function(){pageableInventoryList.fetch({reset:!0})})}),$("#deleteInventory").click(function(){var a=pageableGrid.getSelectedModels();idsToDelete=[],a.forEach(function(a){idsToDelete.push(a.get("_id"))}),$("#deleteModal ul").html(_.template($("#deleteTemplate").html(),{models:a})),$("#deleteModal").modal("show")}),$("#deleteModal .btn-danger").click(function(){idsToDelete.forEach(function(a){$.ajax({type:"DELETE",url:pageableInventoryList.url+"/"+a}).done(function(){pageableInventoryList.remove(pageableGrid.getSelectedModels())})}),$("#deleteModal").modal("hide")}),$(document).keydown(function(a){if($(event.target).is(":not(input, textarea)"))switch(a.keyCode){case 39:$('.backgrid-paginator a[title="Next"]').trigger("click");break;case 37:$('.backgrid-paginator a[title="Previous"]').trigger("click")}});