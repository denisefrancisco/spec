/*! Spec 0.1.4 */
var Event=Backbone.Model.extend({initialize:function(){}}),PageableEventList=Backbone.PageableCollection.extend({model:Event,state:{pageSize:10},mode:"client",overview:function(){$("#overview").html(_.template($("#overview-template").html(),{events:this.fullCollection.toJSON()}))}}),fullShiftNumber=function(a){return a.shifts.map(function(a){return a.staff}).filter(function(a){return a}).length},StaffNumberCell=Backgrid.Cell.extend({render:function(){return this.$el.html(fullShiftNumber(this.model.attributes)),this}}),InventoryCell=Backgrid.Cell.extend({render:function(){return this.$el.html(this.model.get("inventory").reduce(function(a,b){return a+parseInt(b.amt)},0)),this}}),columns=[{name:"",cell:"select-row",headerCell:"select-all",renderable:!0},{name:"title",label:"Title",cell:"string",editable:!1},{name:"category",label:"Category",cell:"string",editable:!1},{name:"loc",label:"Location",cell:"string",editable:!1},{name:"start",label:"Date",cell:"date",editable:!1},{name:"shifts",label:"Staff Assigned",cell:StaffNumberCell,editable:!1},{name:"staffNeeded",label:"Staff Needed",cell:"string",editable:!1},{name:"inventory",label:"Inventory",cell:InventoryCell,editable:!1},{name:"cancelled",label:"Cancelled",cell:"boolean",editable:!1},{name:"techMustStay",label:"Tech Must Stay",cell:"boolean",editable:!1},{name:"video",label:"Video",cell:"boolean",editable:!1},{name:"audio",label:"Audio",cell:"boolean",editable:!1}];$(document).ready(function(){var a=new Date;a.setHours(0,0,0,0);var b=new Date(a.getTime()-6048e5);$(".date").datepicker(),$("#d1").datepicker("setValue",b),$("#d2").datepicker("setValue",a),pageableEventList=new PageableEventList;var c=function(){pageableEventList.url="/events?filter="+$("#filter").val()+"&start="+$("#d1").data("datepicker").date.getTime()/1e3+"&end="+$("#d2").data("datepicker").date.getTime()/1e3,pageableEventList.fetch({reset:!0,success:function(){pageableEventList.overview(),"undefined"==typeof done&&(done=!0,$("a:contains('Date')").trigger("click").trigger("click"))}})};$("#filter").change(c),$(".date").on("changeDate",c);var d=new Backgrid.Extension.Paginator({collection:pageableEventList}),e=new Backgrid.Grid({columns:columns,collection:pageableEventList});$stuff=$(".stuff"),$stuff.append(e.render().el),$stuff.after(d.render().el);var f=new Backgrid.Extension.ClientSideFilter({collection:pageableEventList,fields:["title","loc"]});$(".buttons").after(f.render().el),$(f.el).css({"float":"right",margin:"20px"}),c()}),$(document).keydown(function(a){if($(event.target).is(":not(input, textarea)"))switch(a.keyCode){case 39:$('.backgrid-paginator a[title="Next"]').trigger("click");break;case 37:$('.backgrid-paginator a[title="Previous"]').trigger("click")}});